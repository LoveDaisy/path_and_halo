function test_check_curve_loop()
test_cases = {@suite1, @suite2};
num = length(test_cases);

fprintf('Start testing for check_curve_loop...\n');
for i = 1:num
    fprintf('Testing suite %d/%d...\n', i, num);
    test_cases{i}();
    fprintf('suite %d/%d passed!\n', i, num);
end
end

function suite1()
q = [(0:2:360)'; 361];
x = [cosd(q), sind(q)];
[closed, x_new] = geo.check_curve_loop(x, 'eps', sind(1) * 0.2);

assert(closed);
assert(all(abs(x_new(:) - reshape(x(1:end - 2, :), [], 1)) < 1e-6));
end

function suite2()
x = [-2.04095078654058, -0.531105358474905;
    - 2.02718826508263, -0.578746739329539;
    - 2.01076361649507, -0.625338595871617;
    - 1.99128501964254, -0.670446911114336;
    - 1.96840054511865, -0.713507949090527;
    - 1.94187897297624, -0.753852101796005;
    - 1.91169764875238, -0.790785211281493;
    - 1.87809297558277, -0.823720163904130;
    - 1.83668046234982, -0.855637405705642;
    - 1.79231512438216, -0.882004486881131;
    - 1.74582242735478, -0.903156220450931;
    - 1.69788738629315, -0.919653733403904;
    - 1.64902180783256, -0.932125002874017;
    - 1.59958478066874, -0.941168384785902;
    - 1.54981923688147, -0.947310545562123;
    - 1.49988609033333, -0.950996721235930;
    - 1.44989047296385, -0.952596081668366;
    - 1.39990024204073, -0.952412410357676;
    - 1.34995852043357, -0.950695467289402;
    - 1.30009204538195, -0.947651198418865;
    - 1.25031669570098, -0.943450274797053;
    - 1.20064115403127, -0.938234995322538;
    - 1.15106934334191, -0.932124777851476;
    - 1.10160205683012, -0.925220499494389;
    - 1.05223805443687, -0.917607924111220;
    - 1.00297480427857, -0.909360415087878;
    - 0.953808985939331, -0.900541091253804;
    - 0.904736832875712, -0.891204549060330;
    - 0.855754365385440, -0.881398246066554;
    - 0.806857548702467, -0.871163618826256;
    - 0.758042399635502, -0.860536991384368;
    - 0.709305057748386, -0.849550317704145;
    - 0.660641832099848, -0.838231791534336;
    - 0.612049231188178, -0.826606349749578;
    - 0.563523981445854, -0.814696089484390;
    - 0.515063038048800, -0.802520614996933;
    - 0.466663590713282, -0.790097326815933;
    - 0.418323066396388, -0.777441663097880;
    - 0.370039130290579, -0.764567301068076;
    - 0.321809686139257, -0.751486324800442;
    - 0.273632876651684, -0.738209364303020;
    - 0.225507084629773, -0.724745709839690;
    - 0.177430935314873, -0.711103404573052;
    - 0.129403300405199, -0.697289317911427;
    - 0.0814233041751275, -0.683309201346962;
    - 0.0334903321409366, -0.669167728051493;
    0.0143959572379941, -0.654868517026168;
    0.0622356172572208, -0.640414142156899;
    0.110028393387069, -0.625806126088735;
    0.157773698581909, -0.611044918375876;
    0.205470582437778, -0.596129856865973;
    0.253117692878525, -0.581059110708867;
    0.300713228678479, -0.565829602705704;
    0.348254880630398, -0.550436907888600;
    0.395739758492486, -0.534875124182880;
    0.443164299926646, -0.519136709670159;
    0.490524156367338, -0.503212279225409;
    0.537814048979934, -0.487090350980720;
    0.585027585341580, -0.470757029937152;
    0.632157023838585, -0.454195611760603;
    0.679192967442890, -0.437386083850257;
    0.726123960573609, -0.420304492398496;
    0.772935950633156, -0.402922132213449;
    0.819611556940105, -0.385204498772312;
    0.866129059668993, -0.367109916550252;
    0.912460972016565, -0.348587719794629;
    0.958571975296122, -0.329575804804569;
    1.00441585054559, -0.309997285994174;
    1.04993077467378, -0.289755856425514;
    1.09503184551969, -0.268729259006615;
    1.13959869881138, -0.246760012135992;
    1.18345398454404, -0.223642288855369;
    1.22632385263595, -0.199104133929702;
    1.26776099474353, -0.172787397009421;
    1.30698665671453, -0.144244317641478;
    1.34256513401397, -0.113042926794955;
    1.37187203125472, -0.0793328426660351;
    1.39627950471478, -0.0313086941904636;
    1.39931796218591, 0.0180083746749041;
    1.38334129795535, 0.0615386037088946;
    1.35610243355752, 0.0988377768211945;
    1.32255069801881, 0.131429295928119;
    1.28177334190885, 0.163091859764642;
    1.23928648087485, 0.191195137413391;
    1.19567611779078, 0.216870051948863;
    1.15127718039464, 0.240766654342872;
    1.10629737494765, 0.263299404853469;
    1.06087361021028, 0.284750925639435;
    1.01510047943268, 0.305323364741037;
    0.969045819543606, 0.325166581461034;
    0.922759761455894, 0.344394799803160;
    0.876280270172148, 0.363097018502327;
    0.829636682819625, 0.381343815521686;
    0.782852050131702, 0.399191960723701;
    0.735944733889146, 0.416687638909103;
    0.688929525686758, 0.433868760229333;
    0.641818448509859, 0.450766652943580;
    0.594621342606898, 0.467407327108365;
    0.547346301267929, 0.483812433287663;
    0.500000000000000, 0.500000000000000;
    0.452653698732071, 0.515962988705544;
    0.405241735085592, 0.531737839210832;
    0.357768631278944, 0.547334334414900;
    0.310238097111019, 0.562760367610787;
    0.262653149465974, 0.578022155044594;
    0.215016207541000, 0.593124406144471;
    0.167329169167440, 0.608070459058672;
    0.119593472235707, 0.622862387296505;
    0.0718101442522744, 0.637501081860398;
    0.0239798423391743, 0.651986312167526;
    - 0.0238971145435122, 0.666316768196580;
    - 0.0718207197661904, 0.680490085594793;
    - 0.119791258498649, 0.694502854893763;
    - 0.167809291609898, 0.708350615472902;
    - 0.215875643294211, 0.722027834446702;
    - 0.263991391838642, 0.735527870211339;
    - 0.312157863030368, 0.748842919944941;
    - 0.360376625752859, 0.761963949892359;
    - 0.408649489339499, 0.774880606756792;
    - 0.456978502240715, 0.787581107942101;
    - 0.505365951511442, 0.800052107711631;
    - 0.553814362531634, 0.812278535515928;
    - 0.602326498220542, 0.824243401747939;
    - 0.650905356775566, 0.835927564952346;
    - 0.699554166629213, 0.847309452970665;
    - 0.748276376829329, 0.858364728547105;
    - 0.797075640344117, 0.869065887421628;
    - 0.845955786779152, 0.879381773722785;
    - 0.894920779526677, 0.889276993312425;
    - 0.943974650234721, 0.898711200318596;
    - 0.993121400361974, 0.907638225010892;
    - 1.04236485498081, 0.916005001881961;
    - 1.09170844714574, 0.923750244595401;
    - 1.14115490087866, 0.930802798457991;
    - 1.19070576529275, 0.937079580224933;
    - 1.24036072868957, 0.942482988270405;
    - 1.29011660506915, 0.946897632738774;
    - 1.33996582927462, 0.950186195912834;
    - 1.38989420999653, 0.952184192192285;
    - 1.43987755584484, 0.952693368577599;
    - 1.48987658650658, 0.951473505507976;
    - 1.53982924440853, 0.948232525833748;
    - 1.58963912499750, 0.942615273964139;
    - 1.63915831812574, 0.934192446528027;
    - 1.68816282239698, 0.922453584926172;
    - 1.73631981808509, 0.906812667906907;
    - 1.78315065275002, 0.886641970141044;
    - 1.82800475073449, 0.861356060350656;
    - 1.87007802969379, 0.830559853340097;
    - 1.90439729455397, 0.798586388858573;
    - 1.93538140352603, 0.762511194414662;
    - 1.96273606017740, 0.722877914408862;
    - 1.98642751905817, 0.680369058284324;
    - 2.00664707757092, 0.635669120046450;
    - 2.02372725231899, 0.589369621627521;
    - 2.03805659177742, 0.541933681831408;
    - 2.05001967653632, 0.493702114234529;
    - 2.05996501312615, 0.444916912588706;
    - 2.06819276164450, 0.395746803055269;
    - 2.07495353950998, 0.346308613286190;
    - 2.08045225558978, 0.296683251046260;
    - 2.08485358276362, 0.246927028568916;
    - 2.08828741721148, 0.197079495247931;
    - 2.09085362988964, 0.147168816232301;
    - 2.09262588470759, 0.0972154843972875;
    - 2.09365450189477, 0.0472349260888478;
    - 2.09396841596071, -0.00276060837868034;
    - 2.09357628519365, -0.0527605932540709;
    - 2.09246678791429, -0.102755010114470;
    - 2.09060810515205, -0.152733198058859;
    - 2.08794654628136, -0.202682615006119;
    - 2.08440422568630, -0.252587338210347;
    - 2.07987564639243, -0.302426087253064;
    - 2.07422299556485, -0.352169470097864;
    - 2.06726992080404, -0.401776017697917;
    - 2.05879357097290, -0.451186364738836;
    - 2.04851483398885, -0.500314632712125;
    - 2.03608716738728, -0.549035678501711;
    - 2.02108556014327, -0.597166482527103;
    - 2.00299963723446, -0.644439942325116;
    - 1.98123960122454, -0.690470778637057;
    - 1.95517080971774, -0.734718504275353;
    - 1.92419855565356, -0.776464826837830;
    - 1.89214856256686, -0.810835655623522;
    - 1.85607214478726, -0.841710709444344;
    - 1.81629926403785, -0.868615270152756;
    - 1.77340146188545, -0.891309473732967;
    - 1.72806723115803, -0.909825220415248;
    - 1.68096534316161, -0.924419096731675;
    - 1.63265688439719, -0.935480160870586;
    - 1.58356824166982, -0.943442298624554;
    - 1.53400334422100, -0.948725905262182;
    - 1.48417035102241, -0.951708932251703;
    - 1.43420829829101, -0.952717647539657;
    - 1.38420843626903, -0.952027828128598;
    - 1.33422970395628, -0.949870351783800;
    - 1.28430942059262, -0.946437973637895;
    - 1.23447050330197, -0.941891820742143;
    - 1.18472629386852, -0.936367058784721];

[closed, x_new] = geo.check_curve_loop(x, 'eps', 0.05 * 0.1);

assert(closed);
assert(size(x_new, 1) == 177);
end
